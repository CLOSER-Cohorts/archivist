/*
Tipue Search 5.0
Copyright (c) 2015 Tipue
Tipue Search is released under the MIT License
http://www.tipue.com/search


Also altered by @AlexDM0 for live updating :)
*/
var tipuesearch_in={pages:[]};!function(e){e.fn.tipuesearch=function(i,t){var s=e.extend({show:7,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},i);return t===undefined&&(t=!1),this.each(function(){function i(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function r(i,t){e("#tipue_search_content").hide(),e("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>'),e("#tipue_search_content").show();var c="",n=!1,p=!1,u=!0,_=0;found=[];var o=e("#tipue_search_input").val().toLowerCase();if(((o=e.trim(o)).match('^"')&&o.match('"$')||o.match("^'")&&o.match("'$"))&&(u=!1),u){var l=o.split(" ");o="";for(var g=0;g<l.length;g++){for(var d=!0,f=0;f<tipuesearch_stop_words.length;f++)l[g]==tipuesearch_stop_words[f]&&(d=!1,p=!0);d&&(o=o+" "+l[g])}l=(o=e.trim(o)).split(" ")}else o=o.substring(1,o.length-1);if(o.length>=s.minimumLength){if(u){if(t){var v=o;for(g=0;g<l.length;g++)for(f=0;f<tipuesearch_replace.words.length;f++)l[g]==tipuesearch_replace.words[f].word&&(o=o.replace(l[g],tipuesearch_replace.words[f].replace_with),n=!0);l=o.split(" ")}var w=o;for(g=0;g<l.length;g++)for(f=0;f<tipuesearch_stem.words.length;f++)l[g]==tipuesearch_stem.words[f].word&&(w=w+" "+tipuesearch_stem.words[f].stem);l=w.split(" ");for(g=0;g<tipuesearch_in.pages.length;g++){var m=0,x=tipuesearch_in.pages[g].text;for(f=0;f<l.length;f++){var b=new RegExp(l[f],"gi");if(-1!=tipuesearch_in.pages[g].title.search(b))m+=20*tipuesearch_in.pages[g].title.match(b).length;if(-1!=tipuesearch_in.pages[g].text.search(b))m+=20*tipuesearch_in.pages[g].text.match(b).length;if(s.highlightTerms){if(s.highlightEveryTerm)var L=new RegExp("("+l[f]+")","gi");else L=new RegExp("("+l[f]+")","i");x=x.replace(L,'<span class="h01">$1</span>')}if(-1!=tipuesearch_in.pages[g].tags.search(b))m+=10*tipuesearch_in.pages[g].tags.match(b).length;if(-1!=tipuesearch_in.pages[g].url.search(b)&&(m+=20),0!=m)for(var E=0;E<tipuesearch_weight.weight.length;E++)tipuesearch_in.pages[g].url==tipuesearch_weight.weight[E].url&&(m+=tipuesearch_weight.weight[E].score);l[f].match("^-")&&(b=new RegExp(l[f].substring(1),"i"),-1==tipuesearch_in.pages[g].title.search(b)&&-1==tipuesearch_in.pages[g].text.search(b)&&-1==tipuesearch_in.pages[g].tags.search(b)||(m=0))}0!=m&&(found.push({score:m,title:tipuesearch_in.pages[g].title,desc:x,url:tipuesearch_in.pages[g].url}),_++)}}else for(g=0;g<tipuesearch_in.pages.length;g++){m=0,x=tipuesearch_in.pages[g].text,b=new RegExp(o,"gi");if(-1!=tipuesearch_in.pages[g].title.search(b))m+=20*tipuesearch_in.pages[g].title.match(b).length;if(-1!=tipuesearch_in.pages[g].text.search(b))m+=20*tipuesearch_in.pages[g].text.match(b).length;if(s.highlightTerms){if(s.highlightEveryTerm)L=new RegExp("("+o+")","gi");else L=new RegExp("("+o+")","i");x=x.replace(L,'<span class="h01">$1</span>')}if(-1!=tipuesearch_in.pages[g].tags.search(b))m+=10*tipuesearch_in.pages[g].tags.match(b).length;if(-1!=tipuesearch_in.pages[g].url.search(b)&&(m+=20),0!=m)for(E=0;E<tipuesearch_weight.weight.length;E++)tipuesearch_in.pages[g].url==tipuesearch_weight.weight[E].url&&(m+=tipuesearch_weight.weight[E].score);0!=m&&(found.push({score:m,title:tipuesearch_in.pages[g].title,desc:x,url:tipuesearch_in.pages[g].url}),_++)}if(0!=_){if(s.showTitleCount&&0==a){var R=document.title;R=R.replace(/(\(.+\) )/g,""),document.title="("+_+") "+R,a++}1==n&&(c+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+o+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+v+"</a></div>"),1==_?c+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>":(c_c=_.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),c+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+"</div>"),found.sort(function(e,i){return i.score-e.score});var C=0;for(g=0;g<found.length;g++){if(C>=i&&C<s.show+i){if(c+='<div class="tipue_search_content_title"><a href="'+found[g].url+'"'+h+">"+found[g].title+"</a></div>",s.debug&&(c+='<div class="tipue_search_content_debug">Score: '+found[g].score+"</div>"),s.showURL){var T=found[g].url.toLowerCase();0==T.indexOf("http://")&&(T=T.slice(7)),c+='<div class="tipue_search_content_url"><a href="'+found[g].url+'"'+h+">"+T+"</a></div>"}if(found[g].desc){var y=found[g].desc,k="",W=y.split(" ");if(W.length<s.descriptiveWords)k=y;else for(f=0;f<s.descriptiveWords;f++)k+=W[f]+" ";"."!=(k=e.trim(k)).charAt(k.length-1)&&(k+=" ..."),c+='<div class="tipue_search_content_text">'+k+"</div>"}}C++}if(_>s.show){var $=Math.ceil(_/s.show),j=i/s.show;if(c+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',i>0&&(c+='<li><a class="tipue_search_foot_box" id="'+(i-s.show)+"_"+t+'">'+tipuesearch_string_6+"</a></li>"),j<=2){var O=$;$>3&&(O=3);for(f=0;f<O;f++)c+=f==j?'<li class="current">'+(f+1)+"</li>":'<li><a class="tipue_search_foot_box" id="'+f*s.show+"_"+t+'">'+(f+1)+"</a></li>"}else{(O=j+2)>$&&(O=$);for(f=j-1;f<O;f++)c+=f==j?'<li class="current">'+(f+1)+"</li>":'<li><a class="tipue_search_foot_box" id="'+f*s.show+"_"+t+'">'+(f+1)+"</a></li>"}j+1!=$&&(c+='<li><a class="tipue_search_foot_box" id="'+(i+s.show)+"_"+t+'">'+tipuesearch_string_7+"</a></li>"),c+="</ul></div>"}}else c+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else p?c+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(c+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",1==s.minimumLength?c+='<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>":c+='<div id="tipue_search_warning">'+tipuesearch_string_12+" "+s.minimumLength+" "+tipuesearch_string_13+"</div>");e("#tipue_search_content").hide(),e("#tipue_search_content").html(c),e("#tipue_search_content").slideDown(0),e("#tipue_search_replaced").click(function(){r(0,!1)}),e(".tipue_search_foot_box").click(function(){var i=e(this).attr("id").split("_");r(parseInt(i[0]),i[1])})}e.ajaxSetup({async:!1});var a=0;if("live"==s.mode&&0==tipuesearch_in.pages.length)for(var c=0;c<tipuesearch_pages.length;c++)e.get(tipuesearch_pages[c]).done(function(i){var t=e(s.liveContent,i).text();t=t.replace(/\s+/g," ");var r=e(s.liveDescription,i).text();r=r.replace(/\s+/g," ");var a=i.toLowerCase().indexOf("<title>"),h=i.toLowerCase().indexOf("</title>",a+7);if(-1!=a&&-1!=h)var n=i.slice(a+7,h);else n=tipuesearch_string_1;tipuesearch_in.pages.push({title:n,text:r,tags:t,url:tipuesearch_pages[c]})});"json"==s.mode&&e.getJSON(s.contentLocation).done(function(i){tipuesearch_in=e.extend({},i)}),"static"==s.mode&&(tipuesearch_in=e.extend({},tipuesearch));var h="";s.newWindow&&(h=' target="_blank"'),i("q")&&!1===t?(e("#tipue_search_input").val(i("q")),r(0,!0)):!0===t&&r(0,!0),e(this).keyup(function(e){"13"==e.keyCode&&r(0,!0)})})}}(jQuery);