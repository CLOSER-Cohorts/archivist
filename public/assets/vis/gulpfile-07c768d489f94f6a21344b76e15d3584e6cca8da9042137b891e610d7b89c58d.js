function createBanner(){var e=gutil.date(new Date,"yyyy-mm-dd"),i=require("./package.json").version;return String(fs.readFileSync(HEADER)).replace("@@date",e).replace("@@version",i)}function handleCompilerCallback(e,i){e&&gutil.log(e.toString()),i&&i.compilation&&i.compilation.errors&&(i.compilation.errors.forEach(function(e){gutil.log(e.toString())}),(e||i.compilation.errors.length>0)&&gutil.beep())}var fs=require("fs"),async=require("async"),gulp=require("gulp"),gutil=require("gulp-util"),concat=require("gulp-concat"),minifyCSS=require("gulp-minify-css"),rename=require("gulp-rename"),webpack=require("webpack"),uglify=require("uglify-js"),rimraf=require("rimraf"),merge=require("merge-stream"),argv=require("yargs").argv,ENTRY="./index.js",HEADER="./lib/header.js",DIST="./dist",VIS_JS="vis.js",VIS_MAP="vis.map",VIS_MIN_JS="vis.min.js",VIS_CSS="vis.css",VIS_MIN_CSS="vis.min.css",INDIVIDUAL_BUNDLES=[{entry:"./index-timeline-graph2d.js",filename:"vis-timeline-graph2d.min.js"},{entry:"./index-network.js",filename:"vis-network.min.js"},{entry:"./index-graph3d.js",filename:"vis-graph3d.min.js"}],bannerPlugin=new webpack.BannerPlugin(createBanner(),{entryOnly:!0,raw:!0}),webpackModule={loaders:[{test:/\.js$/,exclude:/node_modules/,loader:"babel",query:{cacheDirectory:!0,presets:["es2015"]}}],wrappedContextRegExp:/$^/},webpackConfig={entry:ENTRY,output:{library:"vis",libraryTarget:"umd",path:DIST,filename:VIS_JS,sourcePrefix:"  "},module:webpackModule,plugins:[bannerPlugin],cache:!0},uglifyConfig={outSourceMap:VIS_MAP,output:{comments:/@license/}},compiler=webpack(webpackConfig);gulp.task("clean",function(e){rimraf(DIST+"/img",e)}),gulp.task("bundle-js",function(e){bannerPlugin.banner=createBanner(),compiler.run(function(i,n){handleCompilerCallback(i,n),e()})}),gulp.task("bundle-js-individual",function(e){bannerPlugin.banner=createBanner(),async.each(INDIVIDUAL_BUNDLES,function(e,i){var n={entry:e.entry,output:{library:"vis",libraryTarget:"umd",path:DIST,filename:e.filename,sourcePrefix:"  "},module:webpackModule,plugins:[bannerPlugin,new webpack.optimize.UglifyJsPlugin],cache:!0};webpack(n).run(function(e,n){handleCompilerCallback(e,n),i()})},e)}),gulp.task("bundle-css",function(){var e=["./lib/shared/activator.css","./lib/shared/bootstrap.css","./lib/shared/configuration.css","./lib/timeline/component/css/timeline.css","./lib/timeline/component/css/panel.css","./lib/timeline/component/css/labelset.css","./lib/timeline/component/css/itemset.css","./lib/timeline/component/css/item.css","./lib/timeline/component/css/timeaxis.css","./lib/timeline/component/css/currenttime.css","./lib/timeline/component/css/customtime.css","./lib/timeline/component/css/animation.css","./lib/timeline/component/css/dataaxis.css","./lib/timeline/component/css/pathStyles.css","./lib/network/css/network-manipulation.css","./lib/network/css/network-tooltip.css","./lib/network/css/network-navigation.css","./lib/network/css/network-colorpicker.css"];return gulp.src(e).pipe(concat(VIS_CSS)).pipe(gulp.dest(DIST)).pipe(minifyCSS()).pipe(rename(VIS_MIN_CSS)).pipe(gulp.dest(DIST))}),gulp.task("copy",["clean"],function(){var e=gulp.src("./lib/network/img/**/*").pipe(gulp.dest(DIST+"/img/network")),i=gulp.src("./lib/timeline/img/**/*").pipe(gulp.dest(DIST+"/img/timeline"));return merge(e,i)}),gulp.task("minify",["bundle-js"],function(e){var i=uglify.minify([DIST+"/"+VIS_JS],uglifyConfig);fs.writeFileSync(DIST+"/"+VIS_MIN_JS,i.code+"\n"),fs.writeFileSync(DIST+"/"+VIS_MAP,i.map.replace(/"\.\/dist\//g,'"')),e()}),gulp.task("bundle",["bundle-js","bundle-js-individual","bundle-css","copy"]);var bundle="bundle"in argv,minify="minify"in argv,watchTasks=[];bundle||minify?(watchTasks=[],bundle&&watchTasks.push("bundle"),minify&&watchTasks.push("minify")):watchTasks=["bundle","minify"],gulp.task("watch",watchTasks,function(){gulp.watch(["index.js","lib/**/*"],watchTasks)}),gulp.task("default",["clean","bundle","minify"]);