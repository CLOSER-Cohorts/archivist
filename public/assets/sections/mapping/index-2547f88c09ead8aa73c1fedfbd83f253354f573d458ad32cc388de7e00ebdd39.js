(function(){var t;(t=angular.module("archivist.mapping",["ngRoute","archivist.flash","archivist.data_manager"])).config(["$routeProvider",function(t){return t.when("/instruments/:id/map",{templateUrl:"partials/instruments/map.html",controller:"MappingController"})}]),t.controller("MappingController",["$scope","$routeParams","DataManager",function(t,e,n){var o;return t.instrument=n.getInstrument(e.id,{constructs:!0,questions:!0,variables:!0},function(){return n.resolveConstructs(),n.resolveQuestions()}),t.tags={},t.variable={},t.addVariable=function(e,n){return t.tags[n]=t.tags[n]||[],t.tags[n]=o(t.tags[n],e,n)},t.deleteVariable=function(e,n){return t.tags[e].splice(n,1)},t.detectKey=function(t,e,o,i){var a;return null==o&&(o=null),null==i&&(i=null),13===t.keyCode&&(a=t.target.value.split(","),e.$add_mapping({variable_names:a,x:null,y:null},function(){return n.resolveQuestions()})),console.log(e)},o=function(e,n,o){return console.log(e),-1===e.map(function(t){return t.id}).indexOf(n.id)&&e.push(n),t.variable.added[o]=null,e},console.log("Controller scope"),console.log(t),t.split_mapping=function(t,e,n,o){return null==n&&(n=null),null==o&&(o=null),t.$split_mapping({variable_id:e,x:n,y:o})}}]),t.directive("aTopics",["$compile","bsLoadingOverlayService","DataManager","Flash",function(t,e,n,o){var i;return i=function(t){return console.log(t),'<select class="form-control" data-ng-model="model.topic.id" data-ng-init="model.topic.id = model.topic.id || model.ancestral_topic.id" style="width: 100%; max-width:600px;" convert-to-number data-ng-change="updateTopic()" data-ng-if="model.topic || !model.strand"><option value=""><em>Clear</em></option><option data-ng-repeat="topic in topics" data-ng-selected="topic.id == model.topic.id" data-a-topic-indent="{{topic.level}}" class="a-topic-level-{{topic.level}}" value="{{topic.id}}">{{topic.name}}</option></select><span class="a-topic" data-ng-if="!model.topic && model.strand">{{model.strand.topic.name}}</span>'},{restrict:"E",require:"ngModel",scope:{model:"=ngModel"},link:{post:function(a,l){var r;return r=function(){var e;return console.log("a topic init"),a.model.orig_topic=a.model.topic,a.topics=n.getTopics({flattened:!0}),e=t(i(a))(a),l.replaceWith(e)},a.updateTopic=function(){return e.start(),n.updateTopic(a.model,a.model.topic.id).then(function(){return a.model.orig_topic=a.model.topic},function(t){return a.model.topic=a.model.orig_topic,o.add("danger",t.data.message)})["finally"](function(){return e.stop()})},r()}}}}]),t.directive("aTopicIndent",[function(){return{restrict:"A",scope:{},link:{post:function(t,e,n){return t.$watch("topic",function(){return e.text("--".repeat(parseInt(n.aTopicIndent)-1)+e.text())})}}}}])}).call(this);