(function(){var e=[].slice;angular.module("archivist.build").controller("BuildCodeListsController",["$controller","$scope","$routeParams","$location","$filter","$timeout","Flash","DataManager","RealTimeListener","RealTimeLocking",function(t,n,r,o,s,i,u,c,l,d){return console.log("called code_list controller"),n.load_sidebar=function(){var e,t;return e=function(e){return e.count=e.used_by.length,e},n.sidebar_objs=function(){var r,o,s,i;for(i=[],r=0,o=(s=n.instrument.CodeLists).length;r<o;r++)t=s[r],i.push(e(t));return i}().sort_by_property(),i(function(){var e;if(null!==(e=localStorage.getItem("sidebar_scroll")))return console.log(e),jQuery(".sidebar").scrollTop(e),localStorage.removeItem("sidebar_scroll")},0)},n["delete"]=function(){var e;if(null!=(e=n.instrument.CodeLists.get_index_by_id(parseInt(r.code_list_id))))return n.instrument.CodeLists[e].$delete({},function(){return n.instrument.CodeLists.splice(e,1),n.load_sidebar(),i(function(){return n.instrument.CodeLists.length>0?n.change_panel(n.instrument.CodeLists[0]):n.change_panel({type:"CodeList",id:"new"})},0)})},n.save=function(){var e;return console.log(n.current),"new"===r.code_list_id?(n.instrument.CodeLists.push(n.current),e=n.instrument.CodeLists.length-1,n.instrument.CodeLists[e].instrument_id=r.id):(angular.copy(n.current,n.instrument.CodeLists.select_resource_by_id(parseInt(r.code_list_id))),e=n.instrument.CodeLists.get_index_by_id(parseInt(r.code_list_id))),n.instrument.CodeLists[e].save({},function(e){return e.instrument_id=n.instrument.id,u.add("success","Code list updated successfully!"),n.reset(),n.load_sidebar(),c.Data.Codes.Categories=c.Codes.Categories.requery({instrument_id:n.instrument.id}),c.Data.ResponseDomains.Codes=c.ResponseDomains.Codes.requery({instrument_id:n.instrument.id}),c.Data.Codes.Categories.$promise.then(function(){return n.categories=c.Data.Codes.Categories}),c.Data.ResponseDomains.Codes.$promise.then(function(){return c.groupResponseDomains()})},function(){return console.log("error")}),c.Data.ResponseDomains[r.id]=null},n.title="Code Lists",n.instrument_options={codes:!0},n.reset=function(){if(console.log("reset called"),null==c.CodeResolver&&c.resolveCodes(),isNaN(r.code_list_id)||(n.current=angular.copy(n.instrument.CodeLists.select_resource_by_id(parseInt(r.code_list_id))),n.editMode=!1,null!=n.current&&d.unlock({type:n.current.type,id:n.current.id})),"new"===r.code_list_id)return n.editMode=!0,n.current=new c.Codes.CodeLists.resource({codes:[]})},n["new"]=function(){return n.change_panel({type:"CodeList",id:"new"})},n.removeCode=function(e){var t,r,o;for(r in n.current.codes=function(){var r,o,s,i;for(i=[],r=0,o=(s=n.current.codes).length;r<o;r++)(t=s[r]).$$hashKey!==e.$$hashKey&&i.push(t);return i}(),n.current.codes.sort(function(e,t){return e.order-t.order}),o=[],n.current.codes)o.push(n.current.codes[r].order=r);return o},n.moveUp=function(e){return n.moveCode(e,-1)},n.moveDown=function(e){return n.moveCode(e,1)},n.moveCode=function(t,r){var o,s,i,u,c;if((i=n.current.codes.findIndex(function(e){return e.$$hashKey===t.$$hashKey}))+r<0||i+r>=n.current.codes.length)return!1;for(s in o=n.current.codes.splice(i,1),(u=n.current.codes).splice.apply(u,[i+r,0].concat(e.call(o))),c=[],n.current.codes)c.push(n.current.codes[s].order=s);return c},n.after_instrument_loaded=function(){return n.categories=c.Data.Codes.Categories,console.log(n.sidebar_objs),n.load_sidebar(),n.$watch("current.newValue",function(e,t,r){if(console.log(e,t,r),e!==t&&null!=e)return r.current.codes.push({id:null,value:e,category:null,order:n.current.codes.length}),n.current.newValue=null,i(function(){var e;return jQuery(".code-value").last().focus(),e=2*jQuery(".code-value").last().val().length,jQuery(".code-value").last()[0].setSelectionRange(e,e)},0)})},t("BaseBuildController",{$scope:n,$routeParams:r,$location:o,Flash:u,DataManager:c,RealTimeListener:l,RealTimeLocking:d})}])}).call(this);