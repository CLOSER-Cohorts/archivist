(function(){angular.module("archivist.build").controller("BuildQuestionsController",["$controller","$scope","$routeParams","$location","$timeout","Flash","DataManager","RealTimeListener","RealTimeLocking",function(e,t,n,r,s,i,u,o,l){return t.load_sidebar=function(){return t.sidebar_objs=t.instrument.Questions.Items.concat(t.instrument.Questions.Grids).sort_by_property()},t.add_rd=function(e){return"question_items"===n.question_type?(null==t.current.rds&&(t.current.rds=[]),t.current.rds.push(e)):(t.current_grid_column.rd=e,jQuery("#add-rd").modal("hide"),!0)},t.remove_rd=function(e){var r;return"question_items"===n.question_type?(r=t.current.rds.indexOf(e),t.current.rds.splice(r,1)):e.rd=null},t["delete"]=function(){var e,r;if(null!=(r="question_items"===n.question_type?"Items":"Grids")&&null!=(e=t.instrument.Questions[r].get_index_by_id(parseInt(n.question_id))))return t.instrument.Questions[r][e].$delete({},function(){return t.instrument.Questions[r].splice(e,1),t.load_sidebar(),s(function(){return t.instrument.Questions[r].length>0?t.change_panel(t.instrument.Questions[r][0]):t.change_panel({type:n.question_type,id:"new"})},0)})},t.select_x_axis=function(){return t.current.cols=angular.copy(t.instrument.CodeLists.select_resource_by_id(t.current.horizontal_code_list_id).codes)},t.set_grid_column=function(e){return t.current_grid_column=e},t.save=function(){var e,r;if(null!=(r="question_items"===n.question_type?"Items":"Grids"))return"new"===n.question_id?(t.instrument.Questions[r].push(t.current),e=t.instrument.Questions[r].length-1,t.instrument.Questions[r][e].instrument_id=n.id):(angular.copy(t.current,t.instrument.Questions[r].select_resource_by_id(parseInt(n.question_id))),e=t.instrument.Questions[r].get_index_by_id(parseInt(n.question_id))),t.instrument.Questions[r][e].save({},function(e){return e.instrument_id=t.instrument.id,i.add("success","Question updated successfully!"),t.reset(),t.load_sidebar()},function(){return console.log("error")})},t.title="Questions",t.extra_url_parameters=["questions"],t.instrument_options={questions:!0,rds:!0,codes:!0},t.reset=function(){return console.log("reset called"),null!=n.question_type&&("question_items"===n.question_type?(t.current=angular.copy(t.instrument.Questions.Items.select_resource_by_id(parseInt(n.question_id))),t.title="Question Item"):(t.current=angular.copy(t.instrument.Questions.Grids.select_resource_by_id(parseInt(n.question_id))),t.title="Question Grid"),t.editMode=!1,null!=t.current&&l.unlock({type:t.current.type,id:t.current.id}),"new"===n.question_id&&(t.editMode=!0,"question_items"===n.question_type?(t.current=new u.Constructs.Questions.item.resource({}),t.current.type="QuestionItem"):"question_grids"===n.question_type&&(t.current=new u.Constructs.Questions.grid.resource({}),t.current.type="QuestionGrid"))),null},t["new"]=function(e){return null==e&&(e=!1),!1===e?jQuery("#new-question").modal("show"):s(function(){return t.change_panel({type:e,id:"new"})},0),null},t.after_instrument_loaded=function(){return t.load_sidebar(),u.resolveCodes(),console.log(t.sidebar_objs)},e("BaseBuildController",{$scope:t,$routeParams:n,$location:r,$timeout:s,Flash:i,DataManager:u,RealTimeListener:o,RealTimeLocking:l})}])}).call(this);