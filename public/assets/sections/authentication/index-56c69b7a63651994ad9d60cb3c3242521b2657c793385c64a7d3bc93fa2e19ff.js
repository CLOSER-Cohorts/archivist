(function(){var t;(t=angular.module("archivist.users",["archivist.flash"])).controller("UserController",["$scope","$location","$http","$route","User","DataManager",function(t,e,r,n,o,s){return t.sign_in=function(r){return t.user.set("email",r.email),t.user.sign_in(r.password).then(function(){return e.path("/instruments")},function(){return t.publish_flash(),r.password="",s.clearCache(),n.reload(),console.log("User logged in.")})},t.sign_up=function(r){return t.user.set("email",r.email),t.user.set("first_name",r.fname),t.user.set("last_name",r.lname),t.user.set("group_id",r.group),t.user.sign_up(r.password,r.confirm).then(function(){return e.path("/instruments"),!0},function(){return t.publish_flash(),r.password="",r.confirm="",s.clearCache(),n.reload(),!1})},r.get("/user_groups/external.json").then(function(e){return t.sign_up_groups=e.data}),console.log(t)}]),t.factory("User",["$http","$q","$route","Flash","DataManager",function(t,e,r,n,o){return function(){function s(t){this.email=t,this.logged_in=!1}return s.attributes=["email","first_name","last_name","group","group_id","role"],s.prototype.sign_in=function(s){var a;return a=this,t.post("/users/sign_in.json",{user:{email:this.email,password:s,remember_me:1}}).then(function(t){return o.clearCache(),r.reload(),a.logged_in=!0,a.set("first_name",t.data.first_name),a.set("last_name",t.data.last_name),a.set("group",t.data.group),a.set("role",t.data.role),!0},function(t){return a.logged_in=!1,n.add("danger",t.data.error),e.reject(t.data.error)})},s.prototype.sign_out=function(){var e;return e=this,t["delete"]("/users/sign_out.json").then(function(){return o.clearCache(),r.reload()})["finally"](function(){return e.logged_in=!1})},s.prototype.sign_up=function(e,s){var a;return a=this,t.post("/users.json",{user:this.get_all_data({password:e,password_confirmation:s})}).then(function(t){return o.clearCache(),r.reload(),a.logged_in=!0,a.set("role",t.data.role)},function(t){return a.logged_in=!1,n.add("danger",t.errors)})},s.prototype.is_admin=function(){return"admin"===this.get("role")},s.prototype.is_editor=function(){return"admin"===this.get("role")||"editor"===this.get("role")},s.prototype.get=function(t){return this[t]},s.prototype.set=function(t,e){return this[t]=e},s.prototype.get_all_data=function(t){var e,r,n,o,s,a;for(null==t&&(t={}),s={},r=0,o=(a=this.constructor.attributes).length;r<o;r++)s[e=a[r]]=this.get(e);for(n in t)s[n]=t[n];return s},s}()}])}).call(this);