var io=require("socket.io"),server=io(process.env.ZUUL_PORT||3210,{pingInterval:2e3}),expect=require("expect.js");server.of("/foo").on("connection",function(){}),server.of("/timeout_socket").on("connection",function(){}),server.of("/valid").on("connection",function(){}),server.of("/asd").on("connection",function(){}),server.of("/abc").on("connection",function(e){e.emit("handshake",e.handshake)}),server.use(function(e,t){if(e.request._query.fail)return t(new Error("Auth failed (main namespace)"));t()}),server.of("/no").use(function(e,t){t(new Error("Auth failed (custom namespace)"))}),server.on("connection",function(e){e.on("hi",function(){e.emit("hi")}),e.on("ack",function(){e.emit("ack",function(t,n){5===t&&n.test&&e.emit("got it")})}),e.on("getAckDate",function(e,t){t(new Date)}),e.on("getDate",function(){e.emit("takeDate",new Date)}),e.on("getDateObj",function(){e.emit("takeDateObj",{date:new Date})}),e.on("getUtf8",function(){e.emit("takeUtf8","\u3066\u3059\u3068"),e.emit("takeUtf8","\u042f \u0411 \u0413 \u0414 \u0416 \u0419"),e.emit("takeUtf8","\xc4 \xe4 \xdc \xfc \xdf"),e.emit("takeUtf8","utf8 \u2014 string"),e.emit("takeUtf8","utf8 \u2014 string")}),e.on("false",function(){e.emit("false",!1)}),e.on("doge",function(){var t=new Buffer("asdfasdf","utf8");e.emit("doge",t)}),e.on("buffa",function(t){Buffer.isBuffer(t)&&e.emit("buffack")}),e.on("jsonbuff",function(t){expect(t.hello).to.eql("lol"),expect(Buffer.isBuffer(t.message)).to.be(!0),expect(t.goodbye).to.eql("gotcha"),e.emit("jsonbuff-ack")});var t=!1;e.on("abuff1",function(e){expect(Buffer.isBuffer(e)).to.be(!0),t=!0}),e.on("abuff2",function(){expect(t).to.be(!0),e.emit("abuff2-ack")}),e.on("blob",function(t){Buffer.isBuffer(t)&&e.emit("back")}),e.on("jsonblob",function(t){expect(t.hello).to.eql("lol"),expect(Buffer.isBuffer(t.message)).to.be(!0),expect(t.goodbye).to.eql("gotcha"),e.emit("jsonblob-ack")});var n=!1,o=!1;e.on("blob1",function(e){expect(Buffer.isBuffer(e)).to.be(!0),n=!0}),e.on("blob2",function(e){expect(n).to.be(!0),expect(e).to.eql("second"),o=!0}),e.on("blob3",function(t){expect(Buffer.isBuffer(t)).to.be(!0),expect(n).to.be(!0),expect(o).to.be(!0),e.emit("blob3-ack")}),e.on("getbin",function(){var t=new Buffer("asdfasdf","utf8");e.emit("takebin",t)}),e.on("getHandshake",function(t){t(e.handshake)})});