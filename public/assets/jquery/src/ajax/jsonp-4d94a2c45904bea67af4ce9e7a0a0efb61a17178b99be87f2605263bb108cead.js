define(["../core","../var/isFunction","./var/nonce","./var/rquery","../ajax"],function(n,a,o,e){"use strict";var r=[],t=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=r.pop()||n.expando+"_"+o++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(o,s,p){var c,l,i,u=!1!==o.jsonp&&(t.test(o.url)?"url":"string"==typeof o.data&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&t.test(o.data)&&"data");if(u||"jsonp"===o.dataTypes[0])return c=o.jsonpCallback=a(o.jsonpCallback)?o.jsonpCallback():o.jsonpCallback,u?o[u]=o[u].replace(t,"$1"+c):!1!==o.jsonp&&(o.url+=(e.test(o.url)?"&":"?")+o.jsonp+"="+c),o.converters["script json"]=function(){return i||n.error(c+" was not called"),i[0]},o.dataTypes[0]="json",l=window[c],window[c]=function(){i=arguments},p.always(function(){l===undefined?n(window).removeProp(c):window[c]=l,o[c]&&(o.jsonpCallback=s.jsonpCallback,r.push(c)),i&&a(l)&&l(i[0]),i=l=undefined}),"script"})});