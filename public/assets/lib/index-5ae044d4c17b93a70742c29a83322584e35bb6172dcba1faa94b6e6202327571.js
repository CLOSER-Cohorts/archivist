(function(){angular.module("archivist.data_manager",["archivist.data_manager.map","archivist.data_manager.instruments","archivist.data_manager.constructs","archivist.data_manager.codes","archivist.data_manager.response_units","archivist.data_manager.response_domains","archivist.data_manager.datasets","archivist.data_manager.variables","archivist.data_manager.variables_instrument","archivist.data_manager.resolution","archivist.data_manager.stats","archivist.data_manager.topics","archivist.data_manager.auth","archivist.realtime","archivist.resource"]).factory("DataManager",["$http","$q","Map","Instruments","Constructs","Codes","ResponseUnits","ResponseDomains","ResolutionService","RealTimeListener","GetResource","ApplicationStats","Topics","InstrumentStats","Datasets","Variables","VariablesInstrument","Auth",function(t,e,s,n,r,a,i,o,u,c,d,l,m,p,h,f,_,g){var v;return(v={}).Data={},v.Instruments=n,v.Constructs=r,v.Codes=a,v.ResponseUnits=i,v.ResponseDomains=o,v.Datasets=h,v.Variables=f,v.VariablesInstrument=_,v.Auth=g,v.clearCache=function(){return v.Data={},v.Data.ResponseDomains={},v.Data.ResponseUnits={},v.Data.InstrumentStats={},v.Data.Users={},v.Data.Groups={},v.Data.Clusters={},v.Instruments.clearCache(),v.Constructs.clearCache(),v.Codes.clearCache(),v.ResponseUnits.clearCache(),v.Datasets.clearCache(),v.Variables.clearCache(),v.VariablesInstrument.clearCache(),v.Auth.clearCache()},v.clearCache(),v.getInstruments=function(t,e,s){return v.Data.Instruments=v.Instruments.query(t,e,s),v.Data.Instruments},v.getDatasets=function(t,e,s){return v.Data.Datasets=v.Datasets.query(t,e,s),v.Data.Datasets},v.getInstrument=function(t,s,n){var r,a,i,o,u,c,d;for(null==s&&(s={}),console.log("getInstrument"),v.progress=0,null==s.codes&&(s.codes=!1),null==s.constructs&&(s.constructs=!1),null==s.questions&&(s.questions=!1),null==s.rds&&(s.rds=!1),null==s.rus&&(s.rus=!1),null==s.instrument&&(s.instrument=!0),null==s.topsequence&&(s.topsequence=!0),null==s.variables&&(s.variables=!1),d=[],v.Data.Instrument=v.Instruments.get({id:t}),d.push(v.Data.Instrument.$promise),s.codes&&(null==(r=v.Data).Codes&&(r.Codes={}),v.Data.Codes.CodeLists=v.Codes.CodeLists.query({instrument_id:t}),d.push(v.Data.Codes.CodeLists.$promise),v.Data.Codes.Categories=v.Codes.Categories.query({instrument_id:t}),d.push(v.Data.Codes.Categories.$promise)),s.constructs&&(null==(a=v.Data).Constructs&&(a.Constructs={}),(!0===s.constructs||s.constructs.conditions)&&(v.Data.Constructs.Conditions=v.Constructs.Conditions.query({instrument_id:t}),d.push(v.Data.Constructs.Conditions.$promise.then(function(t){var e,s,n,r;for(r=[],s=e=0,n=t.length;e<n;s=++e)t[s],r.push(t[s].type="condition");return r}))),(!0===s.constructs||s.constructs.loops)&&(v.Data.Constructs.Loops=v.Constructs.Loops.query({instrument_id:t}),d.push(v.Data.Constructs.Loops.$promise.then(function(t){var e,s,n,r;for(r=[],s=e=0,n=t.length;e<n;s=++e)t[s],r.push(t[s].type="loop");return r}))),(!0===s.constructs||s.constructs.questions)&&(v.Data.Constructs.Questions=v.Constructs.Questions.cc.query({instrument_id:t}),d.push(v.Data.Constructs.Questions.$promise.then(function(t){var e,s,n,r;for(r=[],s=e=0,n=t.length;e<n;s=++e)t[s],r.push(t[s].type="question");return r}))),(!0===s.constructs||s.constructs.statements)&&(v.Data.Constructs.Statements=v.Constructs.Statements.query({instrument_id:t}),d.push(v.Data.Constructs.Statements.$promise.then(function(t){var e,s,n,r;for(r=[],s=e=0,n=t.length;e<n;s=++e)t[s],r.push(t[s].type="statement");return r}))),(!0===s.constructs||s.constructs.sequences)&&(v.Data.Constructs.Sequences=v.Constructs.Sequences.query({instrument_id:t}),d.push(v.Data.Constructs.Sequences.$promise.then(function(t){var e,s,n,r;for(console.log("sequence altering"),r=[],s=e=0,n=t.length;e<n;s=++e)t[s],r.push(t[s].type="sequence");return r})),s.instrument&&("undefined"==typeof v.Data.Instrument.Constructs&&(v.Data.Instrument.Constructs={}),v.Data.Instrument.Constructs.Sequences=v.Data.Constructs.Sequences))),s.questions&&(null==(i=v.Data).Questions&&(i.Questions={}),v.Data.Questions.Items=v.Constructs.Questions.item.query({instrument_id:t}),d.push(v.Data.Questions.Items.$promise),v.Data.Questions.Grids=v.Constructs.Questions.grid.query({instrument_id:t}),d.push(v.Data.Questions.Grids.$promise)),s.rds&&(v.Data.ResponseDomains={},v.Data.ResponseDomains.Codes=v.ResponseDomains.Codes.query({instrument_id:t}),d.push(v.Data.ResponseDomains.Codes.$promise),v.Data.ResponseDomains.Datetimes=v.ResponseDomains.Datetimes.query({instrument_id:t}),d.push(v.Data.ResponseDomains.Datetimes.$promise),v.Data.ResponseDomains.Numerics=v.ResponseDomains.Numerics.query({instrument_id:t}),d.push(v.Data.ResponseDomains.Numerics.$promise),v.Data.ResponseDomains.Texts=v.ResponseDomains.Texts.query({instrument_id:t}),d.push(v.Data.ResponseDomains.Texts.$promise)),s.rus&&(v.Data.ResponseUnits=v.ResponseUnits.query({instrument_id:t}),d.push(v.Data.ResponseUnits.$promise)),s.variables&&(v.Data.Variables=v.VariablesInstrument.query({instrument_id:t}),d.push(v.Data.Variables.$promise)),o=100/d.length,u=0,c=d.length;u<c;u++)d[u]["finally"](function(){if(v.progress+=o,null!=s.progress)return s.progress(v.progress)});return e.all(d).then(function(){var t,e;return console.log("All promises resolved"),s.instrument&&(s.constructs&&(v.Data.Instrument.Constructs={},v.Data.Instrument.Constructs.Conditions=v.Data.Constructs.Conditions,v.Data.Instrument.Constructs.Loops=v.Data.Constructs.Loops,v.Data.Instrument.Constructs.Questions=v.Data.Constructs.Questions,v.Data.Instrument.Constructs.Sequences=v.Data.Constructs.Sequences,v.Data.Instrument.Constructs.Statements=v.Data.Constructs.Statements),s.questions&&(null==(t=v.Data.Instrument).Questions&&(t.Questions={}),v.Data.Instrument.Questions.Items=v.Data.Questions.Items,v.Data.Instrument.Questions.Grids=v.Data.Questions.Grids),s.codes&&(v.Data.Instrument.CodeLists=v.Data.Codes.CodeLists),s.rds&&v.groupResponseDomains(),s.rus&&(v.Data.Instrument.ResponseUnits=v.Data.ResponseUnits),s.variables&&(v.Data.Instrument.Variables=v.Data.Variables)),console.log("callbacks called"),s.constructs&&s.instrument&&s.topsequence&&(v.Data.Instrument.topsequence=function(){var t,s,n,r;for(r=[],t=0,s=(n=v.Data.Instrument.Constructs.Sequences).length;t<s;t++)(e=n[t]).top&&r.push(e);return r}()[0]),"function"==typeof n?n():void 0}),v.Data.Instrument},v.getDataset=function(t,s,n){var r;return null==s&&(s={}),null==s.variables&&(s.variables=!1),null==s.questions&&(s.questions=!1),r=[],v.Data.Dataset=v.Datasets.get({id:t,questions:s.questions}),r.push(v.Data.Dataset.$promise),s.variables&&(v.Data.Variables=v.Variables.query({dataset_id:t}),r.push(v.Data.Variables.$promise)),e.all(r).then(function(){return s.variables&&(v.Data.Dataset.Variables=v.Data.Variables),"function"==typeof n?n():void 0}),v.Data.Dataset},v.groupResponseDomains=function(){return v.Data.Instrument.ResponseDomains=v.Data.ResponseDomains.Datetimes.concat(v.Data.ResponseDomains.Numerics,v.Data.ResponseDomains.Texts,v.Data.ResponseDomains.Codes)},v.getResponseUnits=function(t,e,s){return null==e&&(e=!1),null==v.Data.ResponseUnits[t]||e?v.Data.ResponseUnits[t]=d("/instruments/"+t+"/response_units.json",!0,s):"function"==typeof s?s():void 0},v.getCluster=function(t,e,s,n){var r;return null==s&&(s=!1),r=t+"/"+e,null==v.Data.Clusters[r]||s?v.Data.Clusters[r]=d("/clusters/"+r+".json",!0,n):"function"==typeof n&&n(),v.Data.Clusters[r]},v.resolveConstructs=function(){return null==v.ConstructResolver&&(v.ConstructResolver=new u.ConstructResolver(v.Data.Constructs)),v.ConstructResolver.broken_resolve()},v.resolveQuestions=function(){return null==v.QuestionResolver&&(v.QuestionResolver=new u.QuestionResolver(v.Data.Questions)),v.QuestionResolver.resolve(v.Data.Constructs.Questions)},v.resolveCodes=function(){return null==v.CodeResolver&&(v.CodeResolver=new u.CodeResolver(v.Data.Codes.CodeLists,v.Data.Codes.Categories)),v.CodeResolver.resolve()},v.getApplicationStats=function(){return v.Data.AppStats={$resolved:!1},v.Data.AppStats.$promise=l,v.Data.AppStats.$promise.then(function(t){var e;for(e in t.data)t.data.hasOwnProperty(e)&&(v.Data.AppStats[e]=t.data[e]);return v.Data.AppStats.$resolved=!0}),v.Data.AppStats},v.getTopics=function(t){return null==t&&(t={}),null==t.nested&&(t.nested=!1),null==t.flattened&&(t.flattened=!1),t.nested&&(v.Data.Topics=m.getNested()),t.flattened&&(v.Data.Topics=m.getFlattenedNest()),v.Data.Topics},v.updateTopic=function(t,e){return console.log(t),delete t.topic,delete t.strand,delete t.suggested_topic,t.$update_topic({topic_id:Number.isInteger(e)?e:null})},v.getInstrumentStats=function(t,e){return v.Data.InstrumentStats[t]={$resolved:!1},v.Data.InstrumentStats[t].$promise=p(t),v.Data.InstrumentStats[t].$promise.then(function(s){var n;for(n in s.data)s.data.hasOwnProperty(n)&&(v.Data.InstrumentStats[t][n]=s.data[n]);if(v.Data.InstrumentStats[t].$resolved=!0,null!=e)return e.call()}),v.Data.InstrumentStats[t]},v.getQuestionItemIDs=function(){var t,e,s,n,r;for(s=[],t=0,e=(r=v.Data.Questions.Items).length;t<e;t++)n=r[t],s.push({value:n.id,label:n.label,type:"QuestionItem"});return s},v.getQuestionGridIDs=function(){var t,e,s,n,r;for(s=[],t=0,e=(r=v.Data.Questions.Grids).length;t<e;t++)n=r[t],s.push({value:n.id,label:n.label,type:"QuestionGrid"});return s},v.getQuestionIDs=function(){return v.getQuestionItemIDs().concat(v.getQuestionGridIDs())},v.getUsers=function(){var t;return t=[],v.Data.Users=v.Auth.Users.query(),t.push(v.Data.Users.$promise),v.Data.Groups=v.Auth.Groups.query(),t.push(v.Data.Groups.$promise),e.all(t).then(function(){return null==v.GroupResolver&&(v.GroupResolver=new u.GroupResolver(v.Data.Groups,v.Data.Users)),v.GroupResolver.resolve()})},v.listener=c(function(t,e){var n,r,a,i,o,u,c,d,l,m,p,h,f;if(console.log("Rt update"),null!=e.data){for(p=!1,h=!1,r=0,i=(m=e.data).length;r<i;r++){f=m[r];try{if(null!=(o=s.find(v.Data,f.type).select_resource_by_id(f.id))){for(a in"question"===o.type&&(d=o.question_id,l=o.question_type),f)f[a],-1===["id","type"].indexOf(a)&&(-1!==["children","fchildren"].indexOf(a)&&(u=o.children,c=o.fchildren),o[a]=f[a],-1===["children","fchildren"].indexOf(a)||u===o.children&&c===o.fchildren||(p=!0));"question"!==o.type||d===o.question_id&&l===o.question_type||(o.base=null,h=!0)}else if("Instrument"!==f.type&&null!=f.action&&"ADD"===f.action&&null!=f.instrument_id&&f.instrument_id===v.Data.Instrument.id){for(a in n=s.find(v.Data,f.type),o=new(0,s.find(v,f.type).resource)({}),console.log(o),f)f[a],o[a]=f[a];-1!==["CcLoop","CcCondition","CcQuestion","CcStatement","CcSequence"].indexOf(o.type)&&(o.type=s.translate(o.type)),console.log(o),n.push(o)}}catch(_){}if("Instrument"===f.type&&f.id===v.Data.Instrument.id)for(a in f)f[a],-1===["id","type"].indexOf(a)&&(v.Data.Instrument[a]=f[a])}if(h&&v.resolveQuestions(),p)return v.resolveConstructs()}}),v}])}).call(this),function(){angular.module("archivist.data_manager.auth",["archivist.data_manager.auth.groups","archivist.data_manager.auth.users"]).factory("Auth",["Groups","Users",function(t,e){var s;return(s={}).Groups=t,s.Users=e,s.clearCache=function(){return s.Groups.clearCache(),s.Users.clearCache()},s}])}.call(this),function(){angular.module("archivist.data_manager.auth.groups",["archivist.resource"]).factory("Groups",["WrappedResource",function(t){return new t("user_groups/:id.json",{id:"@id"})}])}.call(this),function(){angular.module("archivist.data_manager.auth.users",["archivist.resource"]).factory("Users",["WrappedResource",function(t){return new t("users/admin/:id.json",{id:"@id"},{save:{method:"PUT"},create:{method:"POST"},"delete":{method:"DELETE",url:"users/admin/:id.json"},reset_password:{method:"POST",url:"users/admin/:id/password.json"},lock:{method:"POST",url:"users/admin/:id/lock.json"}})}])}.call(this),function(){var t;(t=angular.module("archivist.data_manager.codes",["archivist.data_manager.codes.code_lists","archivist.data_manager.codes.categories"])).factory("Codes",["CodeLists","Categories","CodeResolver",function(t,e,s){var n;return(n={}).CodeLists=t,n.Categories=e,n.CodeResolver=s,n.clearCache=function(){return n.CodeLists.clearCache(),n.Categories.clearCache()},n}]),t.factory("CodeResolver",[function(){return{code_list:function(t,e){return t.code_lists.select_resource_by_id(e.code_list_id)},category:function(t,e){return t.categories.select_resource_by_id(e.category_id)},code_lists:function(t,e){var s,n,r,a,i;for(i=[],n=0,r=(a=t.codes).length;n<r;n++)(s=a[n]).category_id===e.id&&i.push(this.code_list(t,s));return i},categories:function(t,e){var s,n,r,a,i;for(i=[],n=0,r=(a=e.codes).length;n<r;n++)s=a[n],i.push(s.label=this.category(t,s).label);return i}}}])}.call(this),function(){angular.module("archivist.data_manager.codes.categories",["archivist.resource"]).factory("Categories",["WrappedResource",function(t){return new t("instruments/:instrument_id/categories/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.codes.code_lists",["archivist.resource"]).factory("CodeLists",["WrappedResource",function(t){return new t("instruments/:instrument_id/code_lists/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.constructs",["archivist.data_manager.constructs.conditions","archivist.data_manager.constructs.loops","archivist.data_manager.constructs.questions","archivist.data_manager.constructs.sequences","archivist.data_manager.constructs.statements"]).factory("Constructs",["Conditions","Loops","Questions","Sequences","Statements",function(t,e,s,n,r){var a;return(a={}).Conditions=t,a.Loops=e,a.Questions=s,a.Sequences=n,a.Statements=r,a.clearCache=function(){return a.Conditions.clearCache(),a.Loops.clearCache(),a.Questions.clearCache(),a.Sequences.clearCache(),a.Statements.clearCache()},a}])}.call(this),function(){angular.module("archivist.data_manager.constructs.conditions",["archivist.resource"]).factory("Conditions",["WrappedResource",function(t){return new t("instruments/:instrument_id/cc_conditions/:id.json",{id:"@id",instrument_id:"@instrument_id"},{save:{method:"PUT"},create:{method:"POST"},update_topic:{method:"POST",url:"instruments/:instrument_id/cc_conditions/:id/set_topic.json"}})}])}.call(this),function(){angular.module("archivist.data_manager.constructs.loops",["ngResource"]).factory("Loops",["WrappedResource",function(t){return new t("instruments/:instrument_id/cc_loops/:id.json",{id:"@id",instrument_id:"@instrument_id"},{save:{method:"PUT"},create:{method:"POST"},update_topic:{method:"POST",url:"instruments/:instrument_id/cc_loops/:id/set_topic.json"}})}])}.call(this),function(){angular.module("archivist.data_manager.constructs.questions",["archivist.resource"]).factory("Questions",["WrappedResource",function(t){return{cc:new t("instruments/:instrument_id/cc_questions/:id.json",{id:"@id",instrument_id:"@instrument_id"},{save:{method:"PUT"},create:{method:"POST"},update_topic:{method:"POST",url:"instruments/:instrument_id/cc_questions/:id/set_topic.json"},split_mapping:{method:"POST",url:"instruments/:instrument_id/cc_questions/:id/remove_variable.json"},add_mapping:{method:"POST",url:"instruments/:instrument_id/cc_questions/:id/add_variables.json"}}),item:new t("instruments/:instrument_id/question_items/:id.json",{id:"@id",instrument_id:"@instrument_id"}),grid:new t("instruments/:instrument_id/question_grids/:id.json",{id:"@id",instrument_id:"@instrument_id"}),clearCache:function(){if("undefined"!=typeof cc&&null!==cc&&cc.clearCache(),"undefined"!=typeof item&&null!==item&&item.clearCache(),"undefined"!=typeof grid&&null!==grid)return grid.clearCache()}}}])}.call(this),function(){angular.module("archivist.data_manager.constructs.sequences",["ngResource"]).factory("Sequences",["WrappedResource",function(t){return new t("instruments/:instrument_id/cc_sequences/:id.json",{id:"@id",instrument_id:"@instrument_id"},{save:{method:"PUT"},create:{method:"POST"},update_topic:{method:"POST",url:"instruments/:instrument_id/cc_sequences/:id/set_topic.json"}})}])}.call(this),function(){angular.module("archivist.data_manager.constructs.statements",["ngResource"]).factory("Statements",["WrappedResource",function(t){return new t("instruments/:instrument_id/cc_statements/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.datasets",["archivist.resource"]).factory("Datasets",["WrappedResource",function(t){return new t("datasets/:id.json",{id:"@id"},{save:{method:"PUT"},create:{method:"POST"}})}])}.call(this),function(){var t;(t=angular.module("archivist.data_manager.instruments",["archivist.resource"])).factory("Instruments",["WrappedResource",function(t){return new t("instruments/:id.json",{id:"@id"},{save:{method:"PUT"},create:{method:"POST"},copy:{method:"POST",url:"instruments/:id/copy/:prefix.json"},clear_cache:{method:"GET",url:"instruments/:id/clear_cache.json"}})}]),t.factory("InstrumentRelationshipResolver",[function(){return function(t,e){switch(e.type){case"CcCondition":return t.conditions.select_resource_by_id(e.id);case"CcLoop":return t.loops.select_resource_by_id(e.id);case"CcQuestion":return t.questions.select_resource_by_id(e.id);case"CcSequence":return t.sequences.select_resource_by_id(e.id);case"CcStatement":return t.statements.select_resource_by_id(e.id)}}}])}.call(this),function(){angular.module("archivist.data_manager.map",[]).factory("Map",[function(){var t;return(t={}).map={Instrument:"Instruments",CcCondition:{Constructs:"Conditions"},CcLoop:{Constructs:"Loops"},CcQuestion:{Constructs:"Questions"},CcSequence:{Constructs:"Sequences"},CcStatement:{Constructs:"Statements"},QuestionItem:{Questions:"Items"},QuestionGrid:{Questions:"Grids"},ResponseDomainText:{ResponseDomains:"Texts"},ResponseDomainNumeric:{ResponseDomains:"Numerics"},ResponseDomainDatetime:{ResponseDomains:"Datetimes"},Variable:"Variables"},t.find=function(e,s){var n;return(n=function(t,e){var s,r,a;if(r=t,"object"==typeof e)for(s in e)a=e[s],e.hasOwnProperty(s)&&(r=n(r[s],a));else r=r[e];return r})(e,t.map[s])},t.translate=function(e){var s;return(s=function(t){return"object"==typeof t?s(t[Object.keys(t)[0]]):t})(t.map[e])},t}])}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,s=this.length;e<s;e++)if(e in this&&this[e]===t)return e;return-1};angular.module("archivist.data_manager.resolution",[]).factory("ResolutionService",["$timeout","$rootScope",function(e,s){var n;return(n={}).ConstructResolver=function(){function n(t){this.constructs=t}return n.prototype.map={CcCondition:"Conditions",CcLoop:"Loops",CcQuestion:"Questions",CcSequence:"Sequences",CcStatement:"Statements"},n.prototype.queue=[],n.prototype.added_to_queue=0,n.prototype.resolve_children=function(t){var n,r,a,i,o,u,c,d,l;for(console.log(t.children),c=t.children.slice().reverse(),a=r=0,o=c.length;r<o;a=++r)null!=(n=c[a]).type&&n.type in this.map&&(t.children[t.children.length-1-a]=this.constructs[this.map[n.type]].select_resource_by_id(n.id)),null!=t.children[t.children.length-1-a].children&&(this.queue.unshift(t.children[t.children.length-1-a]),this.added_to_queue=this.added_to_queue+1);if(null!=t.fchildren)for(d=t.fchildren.slice().reverse(),a=i=0,u=d.length;i<u;a=++i)null!=(n=d[a]).type&&n.type in this.map&&(t.fchildren[t.fchildren.length-1-a]=this.constructs[this.map[n.type]].select_resource_by_id(n.id)),null!=t.fchildren[t.fchildren.length-1-a].children&&(this.queue.unshift(t.fchildren[t.fchildren.length-1-a]),this.added_to_queue=this.added_to_queue+1);return t.resolved=!0,l=this,this.queue.length>0?(console.log("Scheduled resolution"),e(function(t){return a="resolving:"+t.label,console.time(a),l.resolve_children(t),console.timeEnd(a)},0,!1,l.queue.shift())):(console.log("call digest"),s.$digest())},n.prototype.broken_resolve=function(){var t,s;return t=this,this.queue.unshift(function(){var t,e,n,r;for(r=[],t=0,e=(n=this.constructs.Sequences).length;t<e;t++)(s=n[t]).top&&r.push(s);return r}.call(this)[0]),this.added_to_queue=this.added_to_queue+1,e(function(){return t.resolve_children(t.queue.shift())},0)},n.prototype.resolve=function(e,s){var n,r,a,i,o,u,c;for(o in null==e&&(e=["Conditions","Loops","Sequences"]),null==s&&(s=["Conditions","Loops","Questions","Sequences","Statements"]),c=[],u=this.constructs)r=u[o],t.call(e,o)>=0?c.push(function(){var t,e,s,o,u,c,d,l,m;for(m=[],t=0,o=r.length;t<o;t++){for(d=(a=r[t]).children,i=e=0,u=d.length;e<u;i=++e)null!=(n=d[i]).type&&n.type in this.map&&(a.children[i]=this.constructs[this.map[n.type]].select_resource_by_id(n.id));if(null!=a.fchildren)for(l=a.fchildren,i=s=0,c=l.length;s<c;i=++s)null!=(n=l[i]).type&&n.type in this.map&&(a.fchildren[i]=this.constructs[this.map[n.type]].select_resource_by_id(n.id));m.push(a.resolved=!0)}return m}.call(this)):c.push(void 0);return c},n}(),n.QuestionResolver=function(){function t(t){this.questions=t}return t.prototype.map={QuestionItem:"Items",QuestionGrid:"Grids"},t.prototype.resolve=function(t){var e,s,n,r,a,i;for(i=[],r=n=0,a=t.length;n<a;r=++n)s=t[r],i.push(null!=(e=t[r]).base?e.base:e.base=this.questions[this.map[s.question_type]].select_resource_by_id(s.question_id));return i},t}(),n.CodeResolver=function(){function t(t,e){this.code_lists=t,this.categories=e}return t.prototype.category=function(t){return this.categories.select_resource_by_id(t.category_id)},t.prototype.resolve=function(){var t,e,s,n,r,a,i;for(i=[],s=0,r=(a=this.code_lists).length;s<r;s++)e=a[s],i.push(function(){var s,r,a,i;for(a=e.codes,i=[],n=s=0,r=a.length;s<r;n=++s)t=a[n],i.push(e.codes[n].label=this.category(t).label);return i}.call(this));return i},t}(),n.GroupResolver=function(){function t(t,e){this.groups=t,this.users=e}return t.prototype.resolve=function(){var t,e,s,n,r,a,i,o;for(r=this.groups,a=[],e=s=0,n=r.length;s<n;e=++s)t=r[e],this.groups[e].users=[],a.push(function(){var s,n,r,a;for(r=this.users,a=[],o=s=0,n=r.length;s<n;o=++s)i=r[o],t.id===i.group_id?(this.users[o].group=t.label,a.push(this.groups[e].users.push(i))):a.push(void 0);return a}.call(this));return a},t}(),n}])}.call(this),function(){angular.module("archivist.data_manager.response_domains",["archivist.data_manager.response_domains.codes","archivist.data_manager.response_domains.datetimes","archivist.data_manager.response_domains.numerics","archivist.data_manager.response_domains.texts"]).factory("ResponseDomains",["ResponseDomainDatetimes","ResponseDomainNumerics","ResponseDomainTexts","ResponseDomainCodes",function(t,e,s,n){var r;return(r={}).Datetimes=t,r.Numerics=e,r.Texts=s,r.Codes=n,r.clearCache=function(){return r.Datetimes.clearCache(),r.Numerics.clearCache(),r.Texts.clearCache(),r.Codes.clearCache()},r}])}.call(this),function(){angular.module("archivist.data_manager.response_domains.codes",["archivist.resource"]).factory("ResponseDomainCodes",["WrappedResource",function(t){return new t("instruments/:instrument_id/response_domain_codes/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.response_domains.datetimes",["archivist.resource"]).factory("ResponseDomainDatetimes",["WrappedResource",function(t){return new t("instruments/:instrument_id/response_domain_datetimes/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.response_domains.numerics",["archivist.resource"]).factory("ResponseDomainNumerics",["WrappedResource",function(t){return new t("instruments/:instrument_id/response_domain_numerics/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.response_domains.texts",["archivist.resource"]).factory("ResponseDomainTexts",["WrappedResource",function(t){return new t("instruments/:instrument_id/response_domain_texts/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.data_manager.response_units",["archivist.resource"]).factory("ResponseUnits",["WrappedResource",function(t){return new t("instruments/:instrument_id/response_units/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){var t;(t=angular.module("archivist.data_manager.stats",[])).factory("ApplicationStats",["$http",function(t){return t.get("/stats.json",{cache:!0})}]),t.factory("InstrumentStats",["$http",function(t){return function(e){return t.get("/instruments/"+e+"/stats.json",{cache:!0})}}])}.call(this),function(){angular.module("archivist.data_manager.topics",["archivist.resource"]).factory("Topics",["WrappedResource",function(t){var e;return(e=new t("topics/:id.json",{id:"@id"},{getNested:{method:"GET",url:"/topics/nested_index.json",isArray:!0},getFlattenedNest:{method:"GET",url:"/topics/flattened_nest.json",isArray:!0},questionStatistics:{method:"GET",url:"/topics/:id/question_statistics.json",isArray:!0},variableStatistics:{method:"GET",url:"/topics/:id/variable_statistics.json",isArray:!0},save:{method:"PUT"},create:{method:"POST"}})).questionStatistics=function(t,s,n){return e.resource.questionStatistics(t,s,n)},e.variableStatistics=function(t,s,n){return e.resource.variableStatistics(t,s,n)},e.getNested=function(t,s,n){return null==e.data.getNested&&(e.data.getNested=e.resource.getNested(t,s,n)),e.data.getNested},e.regetNested=function(t,s,n){return e.data.getNested=null,e.getNested(t,s,n)},e.getFlattenedNest=function(t,s,n){return null==e.data.getFlattenedNest&&(e.data.getFlattenedNest=e.resource.getFlattenedNest(t,s,n)),e.data.getFlattenedNest},e.regetFlattenedNest=function(t,s,n){return e.data.getFlattenedNest=null,e.getFlattenedNest(t,s,n)},e}])}.call(this),function(){angular.module("archivist.data_manager.variables",["archivist.resource"]).factory("Variables",["WrappedResource",function(t){return new t("datasets/:dataset_id/variables/:id.json",{id:"@id",dataset_id:"@dataset_id"},{save:{method:"PUT"},create:{method:"POST"},update_topic:{method:"POST",url:"datasets/:dataset_id/variables/:id/set_topic.json"},split_mapping:{method:"POST",url:"datasets/:dataset_id/variables/:id/remove_source.json"},add_mapping:{method:"POST",url:"datasets/:dataset_id/variables/:id/add_sources.json"}})}])}.call(this),function(){angular.module("archivist.data_manager.variables_instrument",["archivist.resource"]).factory("VariablesInstrument",["WrappedResource",function(t){return new t("instruments/:instrument_id/variables/:id.json",{id:"@id",instrument_id:"@instrument_id"})}])}.call(this),function(){angular.module("archivist.flash",["ngMessages"]).factory("Flash",["$interval",function(){var t,e,s,n,r;return t="notices",s=JSON.parse(localStorage.getItem(t))||[],n=null,r=function(){return localStorage.setItem(t,JSON.stringify(s))},e=function(){return s=[],r()},{add:function(e,a){if(s.push({type:e,message:a}),r(),document.getElementsByTagName(t))return this.publish(n)},publish:function(t){return t.notices=s,e()},set_scope:function(t){return n=t},listen:function(){},clear:this.clear,store:this.store}}])}.call(this),function(){var t;(t=angular.module("archivist.realtime",["ngRoute","archivist.flash"])).factory("RealTimeConnection",["$rootScope","$timeout","Flash",function(t,e){var s;return(s={}).socket=io(window.socket_url),s.socket.on("disconnect",function(){return t.$apply(function(){return t.realtimeStatus=!1})}),s.socket.on("connect",function(){return e(function(){return t.realtimeStatus=!0})}),s.socket.on("rt-update",function(e){return t.$emit("rt-update",e)}),s}]),t.factory("RealTimeListener",["$rootScope","$http",function(t,e){var s;return(s=function(){function t(t,s){this.handler=t.$on("rt-update",function(n,r){return t.$apply(function(){var a;return a=t.$watch(function(){return e.pendingRequests.length},function(){if(e.pendingRequests.length<1)return s(n,JSON.parse(r)),a()})})})}return t}()).prototype.stop=function(){return this.handler()},function(e){return new s(t,e)}}]),t.factory("RealTimeLocking",["$rootScope","$routeParams","RealTimeConnection",function(t,e,s){var n;return(n={}).locks=[],n.comparator={CodeList:function(t){return e.code_list_id===t.toString()},QuestionItem:function(t){return"question-item"===e.question_type&&e.question_id===t.toString()},QuestionGrid:function(t){return"question-grid"===e.question_type&&e.question_id===t.toString()}},n.lock=function(t){return s.socket.emit("lock",JSON.stringify(t))},n.unlock=function(t){return s.socket.emit("unlock",JSON.stringify(t))},s.socket.on("locks-updated",function(t){var e,s,r,a,i;for(a=JSON.parse(t),$(".lockable").prop("disabled",!1),i=[],e=0,s=a.length;e<s;e++)r=a[e],console.log(r),n.comparator[r.type](r.id)?i.push($(".lockable").prop("disabled",!0)):i.push(void 0);return i}),n}])}.call(this),function(){var t;(t=angular.module("archivist.resource",["ngResource"])).factory("WrappedResource",["$resource",function(t){return function(e,s,n,r){var a;return a=this,this.data={},this.actions=null!=n?n:{save:{method:"PUT"},create:{method:"POST"}},this.index=function(t,s){return e+t+JSON.stringify(s)},this.resource=t(e,s,this.actions,r),this.resource.prototype.save=function(t,e,s){return console.trace(),null!=this.id?this.$save(t,e,s):this.$create(t,e,s)},this.query=function(t,e,s){return null==a.data[this.index("query",t)]&&(a.data[this.index("query",t)]=a.resource.query(t,function(s,n){var r,a,i,o,u;for(r=0,i=s.length;r<i;r++)for(a in o=s[r],t)u=t[a],o[a]=u;if(null!=e)return e(s,n)},s)),a.data[this.index("query",t)]},this.requery=function(t,e,s){return a.data[this.index("query",t)]=null,a.query(t,e,s)},this.get=function(t,e,s){return null==a.data[this.index("get",t)]&&(a.data[this.index("get",t)]=a.resource.get(t,e,s)),a.data[this.index("get",t)]},this.reget=function(t,e,s){return a.data[this.index("get",t)]=null,a.get(t,e,s)},this.clearCache=function(){return a.data={}},this}}]),t.factory("GetResource",["$http",function(t){return function(e,s,n){var r,a;return null==s&&(s=!1),(r=s?[]:{}).$resolved=!1,r.$promise=t.get(e,{cache:!0}),a=r.$promise.then(function(t){var e;for(e in t.data)t.data.hasOwnProperty(e)&&(r[e]=t.data[e]);return r.$resolved=!0}),"function"==typeof n&&a.then(n),r}}])}.call(this),function(){}.call(this);