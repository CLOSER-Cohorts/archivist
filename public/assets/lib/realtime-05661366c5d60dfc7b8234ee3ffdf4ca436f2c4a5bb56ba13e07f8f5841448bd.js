(function(){var t;(t=angular.module("archivist.realtime",["ngRoute","archivist.flash"])).factory("RealTimeConnection",["$rootScope","$timeout","Flash",function(t,n){var e;return(e={}).socket=io(window.socket_url),e.socket.on("disconnect",function(){return t.$apply(function(){return t.realtimeStatus=!1})}),e.socket.on("connect",function(){return n(function(){return t.realtimeStatus=!0})}),e.socket.on("rt-update",function(n){return t.$emit("rt-update",n)}),e}]),t.factory("RealTimeListener",["$rootScope","$http",function(t,n){var e;return(e=function(){function t(t,e){this.handler=t.$on("rt-update",function(o,r){return t.$apply(function(){var i;return i=t.$watch(function(){return n.pendingRequests.length},function(){if(n.pendingRequests.length<1)return e(o,JSON.parse(r)),i()})})})}return t}()).prototype.stop=function(){return this.handler()},function(n){return new e(t,n)}}]),t.factory("RealTimeLocking",["$rootScope","$routeParams","RealTimeConnection",function(t,n,e){var o;return(o={}).locks=[],o.comparator={CodeList:function(t){return n.code_list_id===t.toString()},QuestionItem:function(t){return"question-item"===n.question_type&&n.question_id===t.toString()},QuestionGrid:function(t){return"question-grid"===n.question_type&&n.question_id===t.toString()}},o.lock=function(t){return e.socket.emit("lock",JSON.stringify(t))},o.unlock=function(t){return e.socket.emit("unlock",JSON.stringify(t))},e.socket.on("locks-updated",function(t){var n,e,r,i,u;for(i=JSON.parse(t),$(".lockable").prop("disabled",!1),u=[],n=0,e=i.length;n<e;n++)r=i[n],console.log(r),o.comparator[r.type](r.id)?u.push($(".lockable").prop("disabled",!0)):u.push(void 0);return u}),o}])}).call(this);